<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gro游乐场</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="font-sans max-w-3xl mx-auto px-5 py-5">
    <div class="flex items-center justify-between mb-5">
        <h1 class="text-2xl font-bold m-0">Grok游乐场</h1>
        <div class="flex items-center space-x-3">
            <a href="#" id="grok-link" class="inline-block px-4 py-2 bg-gradient-to-br from-blue-500 to-blue-700 text-white text-sm font-bold rounded-lg shadow-md hover:from-blue-400 hover:to-blue-500 hover:-translate-y-0.5 hover:shadow-lg transition-all duration-300" target="_blank">
                <strong>🚀 点击前往 Grok 聊天页面 🚀</strong>
            </a>
            <a href="https://github.com/tech-shrimp/grok-playground" class="inline-flex items-center gap-2 text-gray-700 bg-gray-100 border border-gray-300 rounded-md px-2 py-1 hover:bg-gray-200 transition-all duration-200" target="_blank">
                <svg height="24" width="24" viewBox="0 0 16 16" version="1.1" aria-hidden="true">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
        </div>
    </div>
    
    <div id="accounts-container" class="space-y-3">
        <!-- 账户将在这里动态生成 -->
    </div>
    
    <button id="add-account" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors">添加新账户</button>
    
    <h2 class="text-xl font-semibold mt-8">当前选中的账户</h2>
    <div id="selected-account-info" class="text-gray-600">未选择任何账户</div>

    <div id="help-panel" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg w-11/12 max-w-xl max-h-[80vh] overflow-y-auto shadow-xl">
            <div class="flex justify-between items-center p-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold m-0">如何获取Grok Cookie</h3>
                <button onclick="closeHelpPanel()" class="text-gray-500 text-2xl hover:text-gray-700 bg-none border-none cursor-pointer">&times;</button>
            </div>
            <div class="p-4">
                <ol class="list-decimal pl-5 space-y-2">
                    <li>开启魔法上网</li>
                    <li>注册账户，并且登录Grok官方网站 (https://grok.com)</li>
                    <li>打开浏览器的开发者工具（按F12）</li>
                    <li>切换到"网络"(Network)标签,刷新页面</li>
                    <li>在网络请求列表中找到一个API请求</li>
                    <li>在请求头(Headers)中找到"Cookie"字段</li>
                    <li>复制整个Cookie值并粘贴到文本框中</li>
                    <li>不要登出账户，如果需要多个Cookie请用无痕模式</li>
                </ol>
            </div>
            <div class="p-2 text-center">
                <img src="how_to_get_cookie.png" class="max-w-full border border-gray-200 rounded shadow-sm">
            </div>
        </div>
    </div>

    <script>
        // JavaScript 部分保持不变
        let accounts = [];
        let selectedAccountId = null;

        function setGrokLink() {
            const grokLink = document.getElementById('grok-link');
            grokLink.href = window.location.origin + '/grok';
        }
        
        function loadAccounts() {
            const savedAccounts = localStorage.getItem('cookieAccounts');
            if (savedAccounts) {
                accounts = JSON.parse(savedAccounts);
            }
            selectedAccountId = localStorage.getItem('selectedAccountId');
            renderAccounts();
            updateSelectedAccountDiv();
        }
        
        function saveAccounts() {
            localStorage.setItem('cookieAccounts', JSON.stringify(accounts));
        }
        
        function renderAccounts() {
            const container = document.getElementById('accounts-container');
            container.innerHTML = '';
            
            accounts.forEach((account, index) => {
                const accountDiv = document.createElement('div');
                accountDiv.className = `border p-4 rounded-md relative ${account.id === selectedAccountId ? 'bg-blue-50 border-blue-500' : 'border-gray-200'}`;
                
                const radioContainer = document.createElement('div');
                radioContainer.className = 'flex items-center mb-2';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'account';
                radio.id = `account-${account.id}`;
                radio.checked = account.id === selectedAccountId;
                radio.className = 'mr-2';
                radio.addEventListener('change', () => selectAccount(account.id));
                
                const label = document.createElement('label');
                label.htmlFor = `account-${account.id}`;
                label.className = 'flex items-center';
                label.innerHTML = `账户 ${index + 1} <a href="#" class="text-blue-500 text-sm ml-2 hover:underline" onclick="openHelpPanel(event)">如何获取cookie?</a>`;
                
                radioContainer.appendChild(radio);
                radioContainer.appendChild(label);
                
                const textarea = document.createElement('textarea');
                textarea.placeholder = '在此粘贴Cookie字符串...';
                textarea.value = account.cookie || '';
                textarea.id = `cookie-${account.id}`;
                textarea.className = 'w-full h-20 mt-2 p-2 border rounded resize-none';
                textarea.addEventListener('input', () => {
                    account.cookie = textarea.value;
                    saveAccounts();
                    if (account.id === selectedAccountId) {
                        document.cookie = `grok_cookie=${encodeURIComponent(account.cookie)}; path=/; max-age=31536000`;
                        updateSelectedAccountDiv();
                    }
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'absolute right-4 top-4 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition-colors';
                deleteBtn.textContent = '删除';
                deleteBtn.addEventListener('click', () => deleteAccount(account.id));
                
                accountDiv.appendChild(radioContainer);
                accountDiv.appendChild(textarea);
                accountDiv.appendChild(deleteBtn);
                
                container.appendChild(accountDiv);
            });
        }
        
        function addAccount() {
            const newId = Date.now().toString();
            accounts.push({ id: newId, cookie: '' });
            renderAccounts();
        }
        
        function deleteAccount(id) {
            if (confirm('确定要删除此账户吗？')) {
                accounts = accounts.filter(account => account.id !== id);
                if (selectedAccountId === id) {
                    selectedAccountId = null;
                    localStorage.removeItem('selectedAccountId');
                    updateSelectedAccountDiv();
                }
                saveAccounts();
                renderAccounts();
            }
        }
        
        function selectAccount(id) {
            selectedAccountId = id;
            localStorage.setItem('selectedAccountId', id);
            const selectedAccount = accounts.find(account => account.id === id);
            if (selectedAccount) {
                document.cookie = `grok_cookie=${encodeURIComponent(selectedAccount.cookie)}; path=/; max-age=31536000`;
            }
            renderAccounts();
            updateSelectedAccountDiv();
        }
        
        function updateSelectedAccountDiv() {
            const infoDiv = document.getElementById('selected-account-info');
            if (!selectedAccountId) {
                infoDiv.textContent = '未选择任何账户';
                return;
            }
            const selectedAccount = accounts.find(account => account.id === selectedAccountId);
            if (!selectedAccount) {
                infoDiv.textContent = '所选账户不存在';
                return;
            }
            const accountIndex = accounts.findIndex(account => account.id === selectedAccountId);
            infoDiv.innerHTML = `
                <p><strong class="font-semibold">当前选中：</strong> 账户 ${accountIndex + 1}</p>
                <p><strong class="font-semibold">Cookie：</strong> ${selectedAccount.cookie ? selectedAccount.cookie.substring(0, 50) + '...' : '无'}</p>
            `;
        }

        function openHelpPanel(event) {
            event.preventDefault();
            document.getElementById('help-panel').style.display = 'flex';
        }
        
        function closeHelpPanel() {
            document.getElementById('help-panel').style.display = 'none';
        }
        
        document.getElementById('add-account').addEventListener('click', addAccount);
        
        window.addEventListener('load', () => {
            loadAccounts();
            setGrokLink();
            if (!selectedAccountId && accounts.length > 0) {
                selectAccount(accounts[0].id);
            }
        });
    </script>
</body>
</html>
